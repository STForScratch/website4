<!DOCTYPE html>
<html>
  <head>
    <title data-locale="feedback.meta.title">Feedback | ScratchTools</title>
    <link rel="stylesheet" href="/style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/images/logo.svg" />
  </head>
  <body>
    <div class="nav">
      <a href="/" class="title">
        <img class="logo" src="/images/logo.svg" />
        <span class="titlespan">ScratchTools</span>
      </a>
      <div class="right">
        <a href="https://docs.scratchtools.app">Docs</a>
        <a href="https://github.com/STForScratch/ScratchTools">Contribute</a>
        <a class="download-btn" href="https://chrome.google.com/webstore/detail/scratchtools/jjnpbalpllpfdpgplpbcbadkgdmleopm">
          <button>Get ScratchTools</button>
        </a>
      </div>
    </div>
    <div class="title-stuff">
      <h1 class="title" data-locale="feedback.main.title">Feedback</h1>
      <p data-locale="feedback.main.short">Have feedback for ScratchTools? Fill out the form below so that we can improve!</p>
    </div>
    <h2 data-locale="feedback.form.label">Fill out the form below to leave feedback</h2>
    <div class="form">
        <input class="ste-username-input" type="text" placeholder="Username">
        <br>
        <textarea class="ste-feedback-input" placeholder="Feedback goes here..."></textarea>
        <br>
        <button class="ste-submit" data-locale="feedback.form.submit">Submit Feedback</button>
    </div>
    <div class="success" style="display: none;">
        Thanks for the feedback! Our developers have received it.
    </div>
    <script>
      async function submit() {
        if (
          document.querySelector(".ste-username-input").value &&
          document.querySelector(".ste-feedback-input").value
        ) {
          document.querySelector(".ste-submit").style.display = "none";
          const send = await (
            await fetch("https://data.scratchtools.app/web-feedback/", {
              method: "POST",
              headers: {
                Accept: "application/json",
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                username: document.querySelector(".ste-username-input").value,
                feedback: document.querySelector(".ste-feedback-input").value,
                useragent: navigator.userAgent,
              }),
            })
          ).json();
          document.querySelector(".form").style.display = "none"
          document.querySelector(".success").style.display = null
          document.querySelector(".ste-submit").style.display = null;
        } else {
          alert(
            "Please make sure that you've entered valid feedback and a username."
          );
        }
      }

      document.querySelector(".ste-submit").addEventListener("click", submit);
    </script>
    <footer>
      <div class="about">
        <img class="footer-logo" src="/images/logo.svg" />
        <p>The perfect extension for Scratch.</p>
      </div>
      <div class="all-links">
        <section class="links">
          <b>Socials</b>
          <a href="https://youtube.com/@ScratchTools">YouTube</a>
          <a href="https://twitter.com/STForScratch">Twitter</a>
          <a href="https://server.scratchtools.app">Community Discord</a>
          <a href="https://discord.gg/kzScDPxE9J">Developer Discord</a>
        </section>
        <section class="links">
          <b>Development</b>
          <a href="https://github.com/STForScratch/ScratchTools">Repository</a>
          <a href="https://github.com/STForScratch">Organization</a>
          <a href="https://docs.scratchtools.app/docs/contributing/how"
            >Documentation</a
          >
          <a href="https://explore.transifex.com/scratchtools/scratchtools/"
            >Localization</a
          >
        </section>
        <section class="links">
          <b>Resources</b>
          <a href="/feedback/">Feedback</a>
          <a href="https://docs.scratchtools.app/docs/privacy-policy"
            >Privacy Policy</a
          >
          <a href="https://docs.scratchtools.app/blog">Blog</a>
          <a href="https://github.com/STForScratch/ScratchTools/discussions"
            >Discussions</a
          >
        </section>
      </div>
      <div class="language-select closed">
        <div class="active-language">
          <img class="dropdown-arrow" src="/images/arrow.svg" />
        </div>
        <div class="other-languages"></div>
      </div>
      <script>
        let languages = {
          en: "English",
          ja: "日本語",
          tr: "Türkçe",
        };

        let langSelect = document.querySelector(".language-select");

        Object.keys(languages).forEach(function (el) {
          let option = document.createElement("div");
          option.className = "lang-option";
          option.dataset.lang = el;

          let img = document.createElement("img");
          img.src = `/flag/${el}`;

          let span = document.createElement("span");
          span.textContent = languages[el];

          option.appendChild(img);
          option.appendChild(span);

          option.addEventListener("click", function () {
            langSelect.classList.remove("open");
            langSelect.classList.add("closed");
            document.cookie =
              "lang=" + el + "; expires=Thu, 18 Dec 9999 12:00:00 UTC; path=/";
            window.location.href = window.location.href;
          });

          langSelect.querySelector(".other-languages").appendChild(option);
        });

        function setActiveLang() {
          let lang = getActiveLanguage();
          let img = document.createElement("img");
          img.src = `/flag/${lang}/`;

          let span = document.createElement("span");
          span.textContent = languages[lang];

          langSelect.querySelector(".active-language").prepend(img, span);
        }
        setActiveLang();

        function getActiveLanguage() {
          const base64String = "<%= language %>";
          const byteCharacters = atob(base64String);
          const byteArray = new Uint8Array(byteCharacters.length);
          for (let i = 0; i < byteCharacters.length; i++) {
            byteArray[i] = byteCharacters.charCodeAt(i);
          }
          const textDecoder = new TextDecoder();
          return JSON.parse(textDecoder.decode(byteArray)).language;
        }

        document
          .querySelector(".active-language")
          .addEventListener("click", function () {
            if (langSelect.className.includes("open")) {
              langSelect.classList.remove("open");
              langSelect.classList.add("closed");
            } else {
              langSelect.classList.add("open");
              langSelect.classList.remove("closed");
            }
          });
      </script>
    </footer>
  </body>
  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
  <script>
    function decodeLocales() {
      const base64String = "<%= language %>";
      const byteCharacters = atob(base64String);
      const byteArray = new Uint8Array(byteCharacters.length);
      for (let i = 0; i < byteCharacters.length; i++) {
        byteArray[i] = byteCharacters.charCodeAt(i);
      }
      const textDecoder = new TextDecoder();
      window.messages = JSON.parse(textDecoder.decode(byteArray)).data;
      Object.keys(messages).forEach(function (el) {
        messages[el] = messages[el].message;
      });
      return;
    }
    decodeLocales();

    document.querySelectorAll("*").forEach(function(el) {
      if (el.dataset.locale) {
        el.textContent = window.messages[el.dataset.locale]
      }
    })

    document.querySelector(
      ".nav .right a[href='https://docs.scratchtools.app']"
    ).textContent = window.messages["nav.docs"];
    document.querySelector(
      ".nav .right a[href='https://github.com/STForScratch/ScratchTools']"
    ).textContent = window.messages["nav.contribute"];
    document.querySelector(".nav .right a.download-btn button").textContent =
      window.messages["nav.get"];
    </script>
</html>
